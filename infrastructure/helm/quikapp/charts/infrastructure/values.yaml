# QuikApp Infrastructure Components Values

# =============================================================================
# Redis Configuration
# =============================================================================
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    password: ""
    existingSecret: "quikapp-secrets"
    existingSecretPasswordKey: "REDIS_PASSWORD"
  master:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
  replica:
    replicaCount: 0
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring

# =============================================================================
# MySQL Configuration
# =============================================================================
mysql:
  enabled: true
  auth:
    rootPassword: ""
    database: quikapp
    username: quikapp
    password: ""
    existingSecret: "quikapp-secrets"
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    configuration: |
      [mysqld]
      default_authentication_plugin=mysql_native_password
      skip-name-resolve
      explicit_defaults_for_timestamp
      basedir=/opt/bitnami/mysql
      plugin_dir=/opt/bitnami/mysql/lib/plugin
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      datadir=/bitnami/mysql/data
      tmpdir=/opt/bitnami/mysql/tmp
      max_allowed_packet=256M
      bind-address=0.0.0.0
      pid-file=/opt/bitnami/mysql/tmp/mysqld.pid
      log-error=/opt/bitnami/mysql/logs/mysqld.log
      character-set-server=utf8mb4
      collation-server=utf8mb4_unicode_ci
      slow_query_log=0
      long_query_time=10.0
      innodb_buffer_pool_size=512M
      innodb_log_file_size=128M
      max_connections=500

      [client]
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      default-character-set=utf8mb4
      plugin_dir=/opt/bitnami/mysql/lib/plugin

      [manager]
      port=3306
      socket=/opt/bitnami/mysql/tmp/mysql.sock
      pid-file=/opt/bitnami/mysql/tmp/mysqld.pid
  secondary:
    replicaCount: 0
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring

# =============================================================================
# PostgreSQL Configuration
# =============================================================================
postgresql:
  enabled: true
  auth:
    postgresPassword: ""
    database: quikapp
    username: quikapp
    password: ""
    existingSecret: "quikapp-secrets"
    secretKeys:
      adminPasswordKey: "POSTGRES_PASSWORD"
      userPasswordKey: "POSTGRES_PASSWORD"
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    extendedConfiguration: |
      max_connections = 500
      shared_buffers = 256MB
      effective_cache_size = 768MB
      maintenance_work_mem = 128MB
      checkpoint_completion_target = 0.9
      wal_buffers = 16MB
      default_statistics_target = 100
      random_page_cost = 1.1
      effective_io_concurrency = 200
      work_mem = 2621kB
      min_wal_size = 1GB
      max_wal_size = 4GB
      max_worker_processes = 4
      max_parallel_workers_per_gather = 2
      max_parallel_workers = 4
      max_parallel_maintenance_workers = 2
  readReplicas:
    replicaCount: 0
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring

# =============================================================================
# MongoDB Configuration
# =============================================================================
mongodb:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    rootPassword: ""
    databases:
      - quikapp
    usernames:
      - quikapp
    passwords: []
    existingSecret: "quikapp-secrets"
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring

# =============================================================================
# Kafka Configuration
# =============================================================================
kafka:
  enabled: true
  replicaCount: 1
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi
  kraft:
    enabled: true
  listeners:
    client:
      protocol: PLAINTEXT
    controller:
      protocol: PLAINTEXT
    interbroker:
      protocol: PLAINTEXT
  extraConfig: |
    auto.create.topics.enable=true
    num.partitions=3
    default.replication.factor=1
    offsets.topic.replication.factor=1
    transaction.state.log.replication.factor=1
    transaction.state.log.min.isr=1
    log.retention.hours=168
    log.retention.bytes=1073741824
  metrics:
    kafka:
      enabled: true
    jmx:
      enabled: true
    serviceMonitor:
      enabled: true
      namespace: monitoring
  zookeeper:
    enabled: false

# =============================================================================
# Elasticsearch Configuration
# =============================================================================
elasticsearch:
  enabled: true
  replicas: 1
  minimumMasterNodes: 1
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  volumeClaimTemplate:
    accessModes: ["ReadWriteOnce"]
    resources:
      requests:
        storage: 30Gi
  esConfig:
    elasticsearch.yml: |
      cluster.name: "quikapp-cluster"
      network.host: 0.0.0.0
      discovery.type: single-node
      xpack.security.enabled: false
      xpack.monitoring.collection.enabled: true
  extraEnvs:
    - name: ES_JAVA_OPTS
      value: "-Xms512m -Xmx512m"

# =============================================================================
# MinIO Configuration
# =============================================================================
minio:
  enabled: true
  mode: standalone
  rootUser: "minioadmin"
  rootPassword: ""
  existingSecret: "quikapp-secrets"
  persistence:
    enabled: true
    size: 50Gi
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  buckets:
    - name: quikapp-files
      policy: none
    - name: quikapp-media
      policy: none
    - name: quikapp-exports
      policy: none
    - name: quikapp-backups
      policy: none
  metrics:
    serviceMonitor:
      enabled: true
      namespace: monitoring
